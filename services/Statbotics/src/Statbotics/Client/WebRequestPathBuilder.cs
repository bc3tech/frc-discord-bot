/*
 * Statbotics REST API
 *
 * The REST API for Statbotics. Please be nice to our servers! If you are looking to do large-scale data science projects, use the CSV exports on the GitHub repo.
 *
 * The version of the OpenAPI document: 3.0.0
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */
namespace Statbotics.Client;

using System;
using System.Collections.Generic;

/// <summary>
/// A URI builder
/// </summary>
internal sealed class WebRequestPathBuilder(string baseUrl, string path)
{
    private readonly string _baseUrl = baseUrl;
    private string _path = path;
    private string _query = "?";

    public void AddPathParameters(Dictionary<string, string?> parameters)
    {
        foreach (var parameter in parameters.Where(p => p.Value is not null))
        {
            _path = _path.Replace("{" + parameter.Key + "}", Uri.EscapeDataString(parameter.Value!));
        }
    }

    public void AddQueryParameters(Multimap<string, string?> parameters)
    {
        foreach (var parameter in parameters.Where(p => p.Value is not null))
        {
            foreach (var value in parameter.Value.Where(p => p is not null))
            {
                _query = _query + parameter.Key + "=" + Uri.EscapeDataString(value!) + "&";
            }
        }
    }

    public string GetFullUri() => string.Concat(_baseUrl, _path, _query.AsSpan(0, _query.Length - 1));
}